const mainCategoriesContainer=document.getElementById("main-categories"),subCategoriesContainer=document.getElementById("sub-categories-container"),subCategories=document.getElementById("sub-categories"),promptCardsContainer=document.getElementById("prompt-cards-container"),searchInput=document.getElementById("search-input"),noResults=document.getElementById("no-results"),promptModal=document.getElementById("prompt-modal"),modalTitle=document.getElementById("modal-title"),modalChinese=document.getElementById("modal-chinese"),modalEnglish=document.getElementById("modal-english"),closeModal=document.getElementById("close-modal"),copyChinese=document.getElementById("copy-chinese"),copyEnglish=document.getElementById("copy-english"),themeToggle=document.getElementById("theme-toggle");let currentMainCategory=null,currentSubCategory=null,searchQuery="",currentPage=1;const ITEMS_PER_PAGE=20,ITEMS_PER_LOAD=10;let loadedItemsCount=0,isLoading=!1,isDarkMode=!1;const categorizedData={},allMainCategories=new Set,allSubCategories=new Set;promptData.forEach(e=>{const t=e.mainCategory,n=e.subCategory;allMainCategories.add(t),allSubCategories.add(n),categorizedData[t]||(categorizedData[t]={}),categorizedData[t][n]||(categorizedData[t][n]=[]),categorizedData[t][n].push(e)});const searchCache=new Map;function renderMainCategories(){const e=document.createDocumentFragment(),t=document.createElement("div");t.className="category-tag main-category "+(null===currentMainCategory?"active":"");const n=promptData.length;t.textContent=`全部 (${n})`,t.addEventListener("click",()=>{currentMainCategory=null,currentSubCategory=null,currentPage=1,renderMainCategories(),renderSubCategories(),renderPromptCards()}),e.appendChild(t),Array.from(allMainCategories).forEach(t=>{const n=document.createElement("div");n.className="category-tag main-category "+(currentMainCategory===t?"active":"");let a=0;categorizedData[t]&&Object.values(categorizedData[t]).forEach(e=>{a+=e.length}),n.textContent=`${t} (${a})`,n.addEventListener("click",()=>{currentMainCategory=t,currentSubCategory=null,currentPage=1,renderMainCategories(),renderSubCategories(),renderPromptCards()}),e.appendChild(n)}),mainCategoriesContainer.innerHTML="",mainCategoriesContainer.appendChild(e)}function renderSubCategories(){const e=document.createDocumentFragment();subCategoriesContainer.classList.toggle("hidden",null===currentMainCategory&&!searchQuery);let t=new Set,n={};currentMainCategory?Object.keys(categorizedData[currentMainCategory]).forEach(e=>{t.add(e),n[e]=categorizedData[currentMainCategory][e].length}):searchQuery?promptData.forEach(e=>{isMatch(e,searchQuery)&&(t.add(e.subCategory),n[e.subCategory]=(n[e.subCategory]||0)+1)}):(t=allSubCategories,promptData.forEach(e=>{n[e.subCategory]=(n[e.subCategory]||0)+1}));const a=document.createElement("div");a.className="category-tag sub-category "+(null===currentSubCategory?"active":""),a.textContent="全部",a.addEventListener("click",()=>{currentSubCategory=null,currentPage=1,loadedItemsCount=0,renderSubCategories(),renderPromptCards(!0)}),e.appendChild(a),Array.from(t).forEach(t=>{const a=document.createElement("div");a.className="category-tag sub-category "+(currentSubCategory===t?"active":""),a.textContent=`${t} (${n[t]})`,a.addEventListener("click",()=>{currentSubCategory=t,currentPage=1,loadedItemsCount=0,renderSubCategories(),renderPromptCards(!0)}),e.appendChild(a)}),subCategories.innerHTML="",subCategories.appendChild(e)}function renderPromptCards(e=!1){let t=[];if(currentMainCategory&&currentSubCategory?t=categorizedData[currentMainCategory]?.[currentSubCategory]||[]:currentMainCategory?Object.values(categorizedData[currentMainCategory]||{}).forEach(e=>{t=t.concat(e)}):currentSubCategory?Object.values(categorizedData).forEach(e=>{e[currentSubCategory]&&(t=t.concat(e[currentSubCategory]))}):t=[...promptData],searchQuery){const e=searchQuery.toLowerCase();searchCache.has(e)?t=searchCache.get(e):(t=t.filter(e=>isMatch(e,searchQuery)),searchCache.set(e,t))}if(0===t.length)noResults.classList.remove("hidden"),promptCardsContainer.innerHTML="",removeLoadMoreButton();else{noResults.classList.add("hidden");if(window.innerWidth<=768){e&&(loadedItemsCount=0,promptCardsContainer.innerHTML="");const n=loadedItemsCount,a=Math.min(n+10,t.length);t.slice(n,a).forEach(e=>{const t=document.createElement("div");t.className="prompt-card fade-in",t.innerHTML=`\n                    <h3 class="mb-1">${e.title}</h3>\n                    <div class="text-xs text-gray-500 mt-auto">\n                        <span>${e.subCategory}</span>\n                    </div>\n                `,t.addEventListener("click",()=>openPromptModal(e)),promptCardsContainer.appendChild(t)}),loadedItemsCount=a,removeLoadMoreButton(),loadedItemsCount<t.length&&addLoadMoreButton()}else{promptCardsContainer.innerHTML="";const e=20*(currentPage-1),n=Math.min(e+20,t.length);t.slice(e,n).forEach(e=>{const t=document.createElement("div");t.className="prompt-card fade-in",t.innerHTML=`\n                    <h3 class="mb-1">${e.title}</h3>\n                    <div class="text-xs text-gray-500 mt-auto">\n                        <span>${e.subCategory}</span>\n                    </div>\n                `,t.addEventListener("click",()=>openPromptModal(e)),promptCardsContainer.appendChild(t)}),renderPagination(t.length)}}}function addLoadMoreButton(){const e=document.createElement("div");e.className="col-span-full text-center mt-6",e.id="load-more-container";const t=document.createElement("button");t.className="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-lg transition-colors",t.textContent="加载更多";const n=document.createElement("div");n.className="hidden mt-2 text-gray-500",n.innerHTML='<i class="fa fa-spinner fa-spin mr-2"></i>加载中...',n.id="loading-indicator",t.addEventListener("click",()=>{isLoading||loadMoreItems()}),e.appendChild(t),e.appendChild(n),promptCardsContainer.appendChild(e)}function removeLoadMoreButton(){const e=document.getElementById("load-more-container");e&&e.remove()}function loadMoreItems(){isLoading=!0;const e=document.getElementById("load-more-container");if(e){const t=e.querySelector("button"),n=document.getElementById("loading-indicator");t&&n&&(t.classList.add("hidden"),n.classList.remove("hidden"))}setTimeout(()=>{renderPromptCards(!1),isLoading=!1;const e=document.getElementById("load-more-container");if(e){const t=e.querySelector("button"),n=document.getElementById("loading-indicator");t&&n&&(t.classList.remove("hidden"),n.classList.add("hidden"))}},300)}function renderPagination(e){const t=Math.ceil(e/20);if(t<=1)return;const n=document.createElement("div");n.className="col-span-full",n.id="pagination-controls";const a=document.createElement("button");a.className="prev-btn "+(1===currentPage?"disabled":""),a.textContent="上一页",a.disabled=1===currentPage,a.addEventListener("click",()=>{currentPage>1&&(currentPage--,renderPromptCards(),window.scrollTo({top:0,behavior:"smooth"}))}),n.appendChild(a);let o=Math.max(1,currentPage-3),r=Math.min(t,o+6);r-o<6&&(o=Math.max(1,r-6));for(let e=o;e<=r;e++){const t=document.createElement("button");t.className="page-btn "+(e===currentPage?"active":""),t.textContent=e,t.addEventListener("click",()=>{currentPage=e,renderPromptCards(),window.scrollTo({top:0,behavior:"smooth"})}),n.appendChild(t)}const d=document.createElement("button");d.className="next-btn "+(currentPage===t?"disabled":""),d.textContent="下一页",d.disabled=currentPage===t,d.addEventListener("click",()=>{currentPage<t&&(currentPage++,renderPromptCards(),window.scrollTo({top:0,behavior:"smooth"}))}),n.appendChild(d),promptCardsContainer.appendChild(n)}function isMatch(e,t){const n=t.toLowerCase();return e.title.toLowerCase().includes(n)||e.chinese.toLowerCase().includes(n)||e.english.toLowerCase().includes(n)}function openPromptModal(e){modalTitle.textContent=e.title,modalChinese.textContent=e.chinese,modalEnglish.textContent=e.english,promptModal.classList.remove("hidden"),document.body.style.overflow="hidden"}function closePromptModal(){promptModal.classList.add("hidden"),document.body.style.overflow=""}function copyToClipboard(e,t){navigator.clipboard.writeText(e).then(()=>{const e=document.createElement("div");e.className="copy-toast",e.textContent=`${t}已复制!`,document.body.appendChild(e),setTimeout(()=>e.classList.add("show"),10),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>document.body.removeChild(e),300)},3e3)})}function toggleDarkMode(){isDarkMode=!isDarkMode,document.body.classList.toggle("dark-mode",isDarkMode);const e=themeToggle.querySelector("i");isDarkMode?(e.className="fa fa-sun-o",localStorage.setItem("theme","dark")):(e.className="fa fa-moon-o",localStorage.setItem("theme","light"))}function applySavedTheme(){if("dark"===localStorage.getItem("theme")){isDarkMode=!0,document.body.classList.add("dark-mode");themeToggle.querySelector("i").className="fa fa-sun-o"}}function handleSearch(){searchQuery=searchInput.value.trim(),currentPage=1,loadedItemsCount=0,renderSubCategories(),renderPromptCards(!0)}function handleResize(){currentPage=1,loadedItemsCount=0,renderPromptCards(!0)}closeModal.addEventListener("click",closePromptModal),promptModal.addEventListener("click",e=>{e.target===promptModal&&closePromptModal()}),copyChinese.addEventListener("click",()=>{copyToClipboard(modalChinese.textContent,"中文提示词")}),copyEnglish.addEventListener("click",()=>{copyToClipboard(modalEnglish.textContent,"英文提示词")}),searchInput.addEventListener("input",handleSearch),searchInput.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),handleSearch())}),themeToggle.addEventListener("click",toggleDarkMode),window.addEventListener("resize",handleResize),document.addEventListener("DOMContentLoaded",()=>{renderMainCategories(),renderSubCategories(),renderPromptCards(!0),applySavedTheme()});